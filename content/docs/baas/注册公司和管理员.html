<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Easemob - 即时通讯云-五分钟为你的APP加入聊天功能。" name="description">
    <meta content="Easemob" name="author">
    <title>Easemob推送 | Easemob</title>
    <link href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/docs.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/highlight.js/7.3/styles/github.min.css" rel="stylesheet">
    <style type="text/css">
      body{font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","WenQuanYi Micro Hei",sans-serif;}
      h1, .h1, h2, .h2, h3, .h3, h4, .h4, .lead {font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","Microsoft YaHei UI","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}
      pre code { background: transparent; }
      @media (min-width: 768px) {
          .bs-docs-home .bs-social,
          .bs-docs-home .bs-masthead-links {
            margin-left: 0;
          }
      }
    </style>
    <!--[if lt IE 9]
    script  type='text/javascript' src=("/assets/js/ie8-responsive-file-warning.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js" ) -->
    <link href="/assets/ico/apple-touch-icon-144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144">
    <link href="/assets/ico/favicon.ico" rel="shortcut icon">
  </head>
  <body><div id="content" class="bs-header">
  <div class="container">
    <h1>
      Easemob推送
    </h1>
    <p>
      Easemob推送, 在1秒内推送上万条数据, 并且支持tag等多维度推送
    </p>
  </div>
</div>
<div class="container bs-docs-container">
  <div class="row">
    <div class="col-md-12" role="main"><h2 id="section">注册公司和管理员</h2>

<p>现在这一步的时候, 需要让用户填写三个东西:</p>

<ul>
  <li>公司名称(中文)</li>
  <li>用户名(英文)</li>
  <li>密码</li>
</ul>

<p>在企信的管理平台内部, 我们需要执行这样的逻辑</p>

<ol>
  <li>根据提供的公司名称来查询此公司是否存在, 如果存在的话则给出提示, 然后终止注册</li>
  <li>如果公司不存在, 则创建一个新的app (这里, 公司在api service中的模型就是app了)</li>
  <li>创建完app之后, 就可以在这个app当中注册此用户了, 注册完成之后, 再赋予他app admin的role</li>
</ol>

<p>下面来详细解释一下如何通过app service 提供的API来完成上述的步骤:</p>

<ol>
  <li>
    <p>服务器端获取token</p>

    <p>因为我们的企信管理后台中, 管理的是各个"公司", 而"公司"的模型在api service中是"application", 所以, 这个管理后台需要能够访问到在这个"org"下面的"application"的数据</p>

    <p>所以, 在这里我们需要使用"easemob"这个org的认证信息来获取token, 这样, 我们就能够拿到整个org的访问权限</p>

    <p>easemob 的 认证信息为:</p>

    <pre><code> client id: b3U6cthDGqwhEeKBpeOIzkQMBQ
 client secret: b3U6UfBWRQRXx3tBDR1EBksgMySP7Co
</code></pre>

    <p>具体如何获取token请参考 https://basecamp.com/2245112/projects/2757123-easemob-external/documents/2893969-app-services "org 级别认证"        </p>

    <p>另外, 需要注意的是, 获取的token是有有效期的, 需要检查此有效期, 并且在过期之前去重新获取</p>
  </li>
  <li>
    <p>查询公司是否存在</p>

    <p>有了token之后, 我们需要检查的是, 在这里用户注册时候提供的公司名称是否已经在系统中存在了, 如果存在的话, 就给出用户一个错误的提示</p>

    <p>这个也很简单, 直接发一个_GET_请求到 <code>http://api.easemob.com/qixin/{company name}</code> 然后检查返回结果就行了</p>

    <p>这里的 <code>{company name}</code>就是用户提供的公司名称, 只不过在我们的程序里面, 我们把它看成了application name, 有一点需要注意的是, 这里的公司名称有可能是中文, 或者英文但是包含空格等等, 所以, 在使用之前, 需要使用 <em>java.net.URLEncoder#encode</em> 来转码</p>
  </li>
  <li>
    <p>创建公司(application)    </p>

    <p>在检查完用户提供的公司名称对应的application不存在之后, 我们接下来就要在api service中创建这个公司了, 用api service的概念来说, 就是在easemob这个org下面创建一个以这个公司名为name的application</p>

    <pre><code> POST /management/easemob/applications -d {"name": {company name}, other properties }
</code></pre>

    <p>注意的是, 这里的company name不需要使用 <em>URIEncoder</em> 来转码, 只在需要用在url中的时候才需要</p>
  </li>
  <li>
    <p>注册用户</p>

    <p>在开头的时候, 就说了, 在企信管理平台上, 用户注册的时候, 实际上是注册两个东西的</p>

    <pre><code> * 注册公司(application)  
 * 在新创建的application中创建这个user, 并且赋予给他admin的role
</code></pre>

    <p>这两步就可以参考 https://basecamp.com/2245112/projects/2757123-easemob-external/documents/3090569-qixin-api-service        </p>
  </li>
</ol>


    </div>
  </div>
</div><footer class="bs-footer" role="contentinfo">
      <div class="container">
        <p class="text-muted">
          环信即时通讯云
        </p>
      </div>
    </footer>
    <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/holder/2.0/holder.min.js"></script>
    <script src="http://cdn.bootcss.com/highlight.js/7.3/highlight.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3e5b3453fdcff1e4dec124ea22f1e189' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script src="/assets/js/application.js"></script>
  </body>
</html>