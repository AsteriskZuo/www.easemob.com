<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Easemob - 即时通讯云-五分钟为你的APP加入聊天功能。" name="description">
    <meta content="Easemob" name="author">
    <title>Updating Collections | Easemob</title>
    <link href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/docs.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/highlight.js/7.3/styles/github.min.css" rel="stylesheet">
    <style type="text/css">
      body{font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","WenQuanYi Micro Hei",sans-serif;}
      h1, .h1, h2, .h2, h3, .h3, h4, .h4, .lead {font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","Microsoft YaHei UI","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}
      pre code { background: transparent; }
      @media (min-width: 768px) {
          .bs-docs-home .bs-social,
          .bs-docs-home .bs-masthead-links {
            margin-left: 0;
          }
      }
    </style>
    <!--[if lt IE 9]
    script  type='text/javascript' src=("/assets/js/ie8-responsive-file-warning.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js" ) -->
    <link href="/assets/ico/apple-touch-icon-144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144">
    <link href="/assets/ico/favicon.ico" rel="shortcut icon">
  </head>
  <body><div id="content" class="bs-header">
  <div class="container">
    <h1>
      Updating Collections
    </h1>
    <p>
      Easemob
    </p>
  </div>
</div>
<div class="container bs-docs-container">
  <div class="row">
    <div class="col-md-12" role="main">
<h1 id="updating-collections">Updating Collections</h1>

<p>This article describes how to perform batch updates on all entities in a
collection. Batch updates require the use of a query string in the
request, which can either specify all entities in the collection or a
subset of entities for the update to be performed on. For more
information on queries, see <a href="/basic-query-syntax">Basic query syntax</a>.</p>

<p><strong>Note:</strong> Although not shown in the API examples below, you need to
provide a valid access token with each API call. See <a href="/authenticating-users-and-application-clients">Authenticating
users and application
clients</a> for details.</p>

<h2 id="batch-updating-entities-in-a-collection">Batch updating entities in a collection</h2>

<ul>
  <li><a href="#curl_update_collection">cURL</a></li>
  <li><a href="#ios_update_collection">iOS</a></li>
  <li><a href="#android_update_collection">Android</a></li>
  <li><a href="#javascript_update_collection">JavaScript (HTML5)</a></li>
  <li><a href="#ruby_update_collection">Ruby</a></li>
  <li><a href="#nodejs_update_collection">Node.js</a></li>
</ul>

<h3 id="example-requestresponse">Example Request/Response</h3>

<h4 id="request">Request:</h4>

<pre><code>curl -X PUT https://api.usergrid.com/your-org/your-app/items/?ql= -d '{"availability":"in-stock"}'
</code></pre>

<p>Note the empty <code>?ql=</code> query string.</p>

<h4 id="response">Response:</h4>

<pre><code>{
  "action" : "put",
  "application" : "f34f4222-a166-11e2-a7f7-02e81adcf3d0",
  "params" : {
    "ql" : [ "" ]
  },
  "path" : "/items",
  "uri" : "http://api.usergrid.com/your-org/your-app/items",
  "entities" : [ {
    "uuid" : "31847b9a-1a62-11e3-be04-8d05e96f700d",
    "type" : "item",
    "name" : "milk",
    "price" : "3.25",
    "availability" : "in-stock"
    "created" : 1378849479113,
    "modified" : 1378849567301,
    "name" : "milk",
  }, {
    "uuid" : "3192ac6a-1a62-11e3-a24f-496ca1d42ce7",
    "type" : "item",
    "name" : "bread",
    "price" : "4.00",
    "availability" : "in-stock"
    "created" : 1378849479206,
    "modified" : 1378849567351,
    "name" : "bread",
  } ],
  "timestamp" : 1378849567280,
  "duration" : 207,
  "organization" : "your-org",
  "applicationName" : "your-app"
}
</code></pre>

<h3 id="request-syntax">Request Syntax</h3>

<pre><code>curl -X PUT https://api.usergrid.com/&lt;org&gt;/&lt;app&gt;/&lt;collection&gt;/?ql= -d {&lt;property&gt;}
</code></pre>

<p>Note the empty query string (ql=) appended to the URL.</p>

<h3 id="parameters">Parameters</h3>

<p>+————————————–+————————————–+
| Parameter                            | Description                          |
+======================================+======================================+
| org                                  | Organization UUID or organization    |
|                                      | name                                 |
+————————————–+————————————–+
| app                                  | Application UUID or application name |
+————————————–+————————————–+
| collection                           | Collection UUID or collection name   |
+————————————–+————————————–+
| property                             | An entity property to be updated,    |
|                                      | formatted as a key-value pair. For   |
|                                      | example:                             |
|                                      |                                      |
|                                      |     {"property<em>1":"value</em>1", "proper |
|                                      | ty<em>2":"value</em>2",…}                 |
+————————————–+————————————–+</p>

<p>This example uses the <a href="/app-services-sdks#ios">Apache Usergrid iOS SDK</a>.</p>

<h3 id="example-requestresponse-1">Example Request/Response</h3>

<h4 id="request-1">Request:</h4>

<pre><code>-(NSString*)updateCollection {

    NSString *url = @"https://api.usergrid.com/your-org/your-app/items/?ql";
    NSString *op = @"PUT";
    NSString *opData = @"{\"availability\":\"in-stock\"}"; //we escape the quotes
    
    //we recommend you call ApigeeClient from your AppDelegate. 
    //for more information see the iOS SDK install guide: http://apigee.com/docs/app-services/content/installing-apigee-sdk-ios
    //create an instance of AppDelegate
    AppDelegate *appDelegate = (AppDelegate *)[[UIApplication sharedApplication] delegate];
    
    //call createEntity to initiate the API call
    ApigeeClientResponse *response = [appDelegate.dataClient apiRequest: url operation: op data: opData];
    
    @try {
        //success
    }
    @catch (NSException * e) {
        //fail
    }

}
</code></pre>

<h4 id="response-1">Response:</h4>

<pre><code>{
  "action" : "put",
  "application" : "f34f4222-a166-11e2-a7f7-02e81adcf3d0",
  "params" : {
    "ql" : [ "" ]
  },
  "path" : "/items",
  "uri" : "http://api.usergrid.com/your-org/your-app/items",
  "entities" : [ {
    "uuid" : "31847b9a-1a62-11e3-be04-8d05e96f700d",
    "type" : "item",
    "name" : "milk",
    "price" : "3.25",
    "availability" : "in-stock"
    "created" : 1378849479113,
    "modified" : 1378849567301,
    "name" : "milk",
  }, {
    "uuid" : "3192ac6a-1a62-11e3-a24f-496ca1d42ce7",
    "type" : "item",
    "name" : "bread",
    "price" : "4.00",
    "availability" : "in-stock"
    "created" : 1378849479206,
    "modified" : 1378849567351,
    "name" : "bread",
  } ],
  "timestamp" : 1378849567280,
  "duration" : 207,
  "organization" : "your-org",
  "applicationName" : "your-app"
}
</code></pre>

<h3 id="sdk-method">SDK Method</h3>

<pre><code>(ApigeeClientResponse *)apiRequest: (NSString *)url operation:(NSString *)op data:(NSString *)opData
</code></pre>

<h3 id="properties">Properties</h3>

<p>+————————————–+————————————–+
| Parameter                            | Description                          |
+======================================+======================================+
| url                                  | A fully-formed request url in the    |
|                                      | following format:                    |
|                                      |     https://api.usergrid.com/<org>/&lt; |
|                                      | app&gt;/<collection>/?ql=               |
|                                      |                                      |
|                                      | Note that you must include an empty  |
|                                      | '?ql=' query string at the end of    |
|                                      | the URL                              |
+--------------------------------------+--------------------------------------+
| op                                   | The HTTP method - in this case,      |
|                                      | 'PUT'                                |
+--------------------------------------+--------------------------------------+
| opData                               | A JSON-formatted string that         |
|                                      | contains the entity properties to be |
|                                      | updated                              |
+--------------------------------------+--------------------------------------+</collection></org></p>

<p>Updating all entities in a collection is not currently supported by the
<a href="/app-services-sdks#android">Apache Usergrid Android SDK</a>.</p>

<p>This example uses the <a href="/app-services-sdks#javascript">Apache Usergrid JavaScript (HTML5)
SDK</a>.</p>

<h3 id="example-requestresponse-2">Example Request/Response</h3>

<h4 id="request-2">Request:</h4>

<pre><code>//create the basic client object
var dataClient = new Usergrid.Client({
    org_name:'your-org',
    app_name:'your-app'
});

//options for the request
var options = {
    endpoint:"items/?ql=", //don't forget to append '/?ql='
    method:"PUT",
    body: {"availability":"in-stock"}
}

dataClient.request(options,function (error,response) {

    if (error) { 
        // Error
    } else { 
        // Success
    }

});    
</code></pre>

<h4 id="response-2">Response:</h4>

<pre><code>Object {action: "put", application: "f34f4222-a166-11e2-a7f7-02e81adcf3d0", params: Object, path: "/items", uri: "http://api.usergrid.com/your-org/your-app/items"…}
action: "put"
application: "f34f4222-a166-11e2-a7f7-02e81adcf3d0"
applicationName: "your-app"
duration: 92
entities: Array[2]
    0: Object
        availability: "in-stock"
        created: 1378852309294
        modified: 1378853303215
        name: "milk"
        price: "3.25"
        type: "item"
        uuid: "c86ffbf0-1a68-11e3-ab22-3713e5fcf9d2"
        __proto__: Object
    1: Object
        availability: "in-stock"
        created: 1378852309373
        modified: 1378853303256
        name: "bread"
        price: "4.00"
        type: "item"
        uuid: "c87be2da-1a68-11e3-80f4-975f1f8b1f86"
        __proto__: Object
    length: 2
    __proto__: Array[0]
organization: "your-org"
params: Object
path: "/items"
timestamp: 1378853303201
uri: "http://api.usergrid.com/your-org/your-app/items"
__proto__: Object
</code></pre>

<h3 id="sdk-method-1">SDK Method</h3>

<pre><code>request(options, callback)
</code></pre>

<h3 id="parameters-1">Parameters</h3>

<p>+————————————–+————————————–+
| Parameter                            | Description                          |
+======================================+======================================+
| options                              | A JSON-formatted object containing   |
|                                      | the following properties:            |
|                                      |                                      |
|                                      | -   endpoint: the UUID or name of    |
|                                      |     the collection to be updated,    |
|                                      |     appended by an empty query       |
|                                      |     string in the format:            |
|                                      |     &lt;collection&gt;/?ql=              |
|                                      | -   method: the HTTP method for the  |
|                                      |     request – in this case <code>PUT</code>     |
|                                      | -   body: the body of the request    |
|                                      |     that specifies the properties to |
|                                      |     be updated in JSON format        |
+————————————–+————————————–+
| callback                             | Callback function to handle the API  |
|                                      | response                             |
+————————————–+————————————–+</p>

<p>This example uses the <a href="/app-services-sdks#ruby">Apache Usergrid RubyGem</a>.</p>

<h3 id="example-requestresponse-3">Example Request/Response</h3>

<h4 id="request-3">Request:</h4>

<pre><code>#Create a client object
usergrid_api = 'https://api.usergrid.com'
organization = 'your-org'
application = 'your-app'

client = Usergrid::Application.new "#{usergrid_api}/#{organization}/#{application}"

begin
    collection = client['items'].collection
    collection.update_query({availability: 'in-stock'},"")
rescue
    #fail
end
</code></pre>

<h4 id="response-3">Response:</h4>

<pre><code>{
  "action" : "put",
  "application" : "f34f4222-a166-11e2-a7f7-02e81adcf3d0",
  "params" : {
    "ql" : [ "" ]
  },
  "path" : "/items",
  "uri" : "http://api.usergrid.com/your-org/your-app/items",
  "entities" : [ {
    "uuid" : "31847b9a-1a62-11e3-be04-8d05e96f700d",
    "type" : "item",
    "name" : "milk",
    "price" : "3.25",
    "availability" : "in-stock"
    "created" : 1378849479113,
    "modified" : 1378849567301,
    "name" : "milk",
  }, {
    "uuid" : "3192ac6a-1a62-11e3-a24f-496ca1d42ce7",
    "type" : "item",
    "name" : "bread",
    "price" : "4.00",
    "availability" : "in-stock"
    "created" : 1378849479206,
    "modified" : 1378849567351,
    "name" : "bread",
  } ],
  "timestamp" : 1378849567280,
  "duration" : 207,
  "organization" : "your-org",
  "applicationName" : "your-app"
}
</code></pre>

<h3 id="sdk-method-2">SDK Method</h3>

<pre><code>collection.update_query(properties, query_string)
</code></pre>

<h3 id="properties-1">Properties</h3>

<p>Parameter       Description
  ————— ————————————————————————————————————–
  properties      JSON-formatted string that contains the entity properties to be updated
  query_string   A query string that specifies the entities to be updated. Use an empty string (<code>""</code>) to update all entities.</p>

<p>The example assumes use of the <a href="/app-services-sdks#nodejs">Apache Usergrid Node.js
module</a>.</p>

<h3 id="example-requestresponse-4">Example Request/Response</h3>

<h4 id="request-4">Request:</h4>

<pre><code>//Create the Apache Usergrid client object
var dataClient = new Usergrid.client({
    org_name:'your-org',
    app_name:'your-app'
});

//Specify the options for the request
var options = {
    endpoint:"items/?ql=", //don't forget to append '/?ql='
    method:"PUT",
    body: {"availability":"in-stock"}
}

dataClient.request(options,function (error,response) {

    if (error) { 
        //error
    } else { 
        //success
    }

});             
</code></pre>

<h4 id="response-4">Response:</h4>

<pre><code>{ action: 'put',
  application: 'f34f4222-a166-11e2-a7f7-02e81adcf3d0',
  params: { ql: [ '' ] },
  path: '/items',
  uri: 'http://api.usergrid.com/your-org/your-app/items',
  entities: 
   [ { uuid: 'c86ffbf0-1a68-11e3-ab22-3713e5fcf9d2',
       type: 'item',
       name: 'milk',
       created: 1378852309294,
       modified: 1378855073613,
       availability: 'in-stock' },
     { uuid: 'c87be2da-1a68-11e3-80f4-975f1f8b1f86',
       type: 'item',
       name: 'bread',
       created: 1378852309373,
       modified: 1378855073655,
       availability: 'in-stock' } ],
  timestamp: 1378855073595,
  duration: 106,
  organization: 'your-org',
  applicationName: 'your-app' }
</code></pre>

<h3 id="sdk-method-3">SDK Method</h3>

<pre><code>request(options,callback);
</code></pre>

<h3 id="parameters-2">Parameters</h3>

<p>+————————————–+————————————–+
| Parameter                            | Description                          |
+======================================+======================================+
| options                              | A JSON-formatted object containing   |
|                                      | the following properties:            |
|                                      |                                      |
|                                      | -   endpoint: the UUID or name of    |
|                                      |     the collection to be updated,    |
|                                      |     appended by an empty query       |
|                                      |     string in the format:            |
|                                      |     &lt;collection&gt;/?ql=              |
|                                      | -   method: the HTTP method for the  |
|                                      |     request, in this case <em>PUT</em>      |
+————————————–+————————————–+
| callback                             | Callback function to handle the API  |
|                                      | response                             |
+————————————–+————————————–+</p>

<p> </p>

    </div>
  </div>
</div><footer class="bs-footer" role="contentinfo">
      <div class="container">
        <p class="text-muted">
          环信即时通讯云
        </p>
      </div>
    </footer>
    <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/holder/2.0/holder.min.js"></script>
    <script src="http://cdn.bootcss.com/highlight.js/7.3/highlight.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3e5b3453fdcff1e4dec124ea22f1e189' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script src="/assets/js/application.js"></script>
  </body>
</html>