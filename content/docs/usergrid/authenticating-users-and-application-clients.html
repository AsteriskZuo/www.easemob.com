<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Easemob - 即时通讯云-五分钟为你的APP加入聊天功能。" name="description">
    <meta content="Easemob" name="author">
    <title>Authenticating users and application clients | Easemob</title>
    <link href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/docs.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/highlight.js/7.3/styles/github.min.css" rel="stylesheet">
    <style type="text/css">
      body{font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","WenQuanYi Micro Hei",sans-serif;}
      h1, .h1, h2, .h2, h3, .h3, h4, .h4, .lead {font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","Microsoft YaHei UI","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}
      pre code { background: transparent; }
      @media (min-width: 768px) {
          .bs-docs-home .bs-social,
          .bs-docs-home .bs-masthead-links {
            margin-left: 0;
          }
      }
    </style>
    <!--[if lt IE 9]
    script  type='text/javascript' src=("/assets/js/ie8-responsive-file-warning.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js" ) -->
    <link href="/assets/ico/apple-touch-icon-144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144">
    <link href="/assets/ico/favicon.ico" rel="shortcut icon">
  </head>
  <body><div id="content" class="bs-header">
  <div class="container">
    <h1>
      Authenticating users and application clients
    </h1>
    <p>
      Easemob
    </p>
  </div>
</div>
<div class="container bs-docs-container">
  <div class="row">
    <div class="col-md-12" role="main">
<h1 id="authenticating-users-and-application-clients">Authenticating users and application clients</h1>

<p>To protect your Apache Usergrid application data, one of the steps you'll
take is to authenticate your app's users. By ensuring that they are who
they say they are, you can help ensure that your application's data is
available in secure ways. After you've created permission rules that
define access to your application and have associated these rules with
users, you'll want to add code that authenticates your user, as
described in this topic.</p>

<p><strong>Note: </strong>You manage access to your application's data by creating
permission rules that govern which users can do what. Users
authenticated as Application User have access according to these rules.
For more about managing permissions, see <a href="/managing-access-defining-permission-rules">Managing access by defining
permission rules</a>.</p>

<h2 id="authentication-levels">Authentication levels</h2>

<p>Apache Usergrid supports four levels of authentication, but only one of
them is used when checking a registered user's permissions. The other
three levels are useful for authenticating other web applications that
want to access to your Apache Usergrid application. Because the scope of
access that the other authentication levels provide is so broad (and as
a result, so powerful), it's a bad practice to use them from a mobile
app. Instead, they're better suited to other client apps, such as web
applications.</p>

<p>The following table describes each of the authentication levels. Note
that only one of these is configurable using the admin portal. The
others are independent of Application User level access, which is
governed by permission rules you define (usually with the admin portal).
In contrast, the level of acces provided by the others is only as
described in the notes.</p>

<p>+——————–+——————–+——————–+——————–+
| Authentication     | Description        | Permissions        | Notes              |
| Level              |                    | Configurable in    |                    |
|                    |                    | Admin Portal       |                    |
+====================+====================+====================+====================+
| Application User   | Allows access to   | Yes                | You allow specific |
|                    | your Apache Usergrid  |                    | access to          |
|                    | application as     |                    | application        |
|                    | governed by the    |                    | resources by       |
|                    | permission rules   |                    | creating           |
|                    | you create and     |                    | permission rules,  |
|                    | associated with    |                    | then associating   |
|                    | users and user     |                    | these rules with   |
|                    | groups.            |                    | users. Typically,  |
|                    |                    |                    | you'll begin by    |
|                    |                    |                    | creating roles,    |
|                    |                    |                    | then create        |
|                    |                    |                    | permission rules   |
|                    |                    |                    | for the roles,     |
|                    |                    |                    | then associate the |
|                    |                    |                    | roles with users   |
|                    |                    |                    | (or groups of      |
|                    |                    |                    | users).            |
|                    |                    |                    |                    |
|                    |                    |                    | Each Application   |
|                    |                    |                    | User is            |
|                    |                    |                    | represented by a   |
|                    |                    |                    | User entity in     |
|                    |                    |                    | your Apache Usergrid  |
|                    |                    |                    | application. (For  |
|                    |                    |                    | more about the     |
|                    |                    |                    | User entity, see   |
|                    |                    |                    | <a href="/user">User</a>.)    |
|                    |                    |                    |                    |
|                    |                    |                    | For more about     |
|                    |                    |                    | roles and          |
|                    |                    |                    | permissions, see   |
|                    |                    |                    | <a href="/managing-a |
|                    |                    |                    | ccess-defining-per |
|                    |                    |                    | mission-rules">Managing access   |
|                    |                    |                    | by defining        |
|                    |                    |                    | permission         |
|                    |                    |                    | rules</a>.    |
|                    |                    |                    | For a look at how  |
|                    |                    |                    | security features  |
|                    |                    |                    | fit together, see  |
|                    |                    |                    | <a href="/app-sec |
|                    |                    |                    | urity-overview">App Security      |
|                    |                    |                    | Overview</a>.   |
+——————–+——————–+——————–+——————–+
| Application        | Allows full access | No                 | Authentication at  |
|                    | to perform any     |                    | this level is      |
|                    | operation on an    |                    | useful in a        |
|                    | Apache Usergrid       |                    | server-side        |
|                    | application        |                    | application (not a |
|                    | account (but not   |                    | mobile app) that   |
|                    | other applications |                    | needs access to    |
|                    | within the same    |                    | resources through  |
|                    | organization).     |                    | the Apache Usergrid   |
|                    | Should not be used |                    | API.               |
|                    | from a mobile      |                    |                    |
|                    | client.            |                    | Imagine that you   |
|                    |                    |                    | created a web site |
|                    |                    |                    | that lists every   |
|                    |                    |                    | hiking trail in    |
|                    |                    |                    | the Rocky          |
|                    |                    |                    | Mountains. Anyone  |
|                    |                    |                    | can go to the web  |
|                    |                    |                    | site and view the  |
|                    |                    |                    | content. However,  |
|                    |                    |                    | you don't want     |
|                    |                    |                    | anyone to have     |
|                    |                    |                    | access to the App  |
|                    |                    |                    | Services API,      |
|                    |                    |                    | where all the data |
|                    |                    |                    | is stored. But you |
|                    |                    |                    | do want to give    |
|                    |                    |                    | your web server    |
|                    |                    |                    | access so that it  |
|                    |                    |                    | can generate the   |
|                    |                    |                    | pages to serve to  |
|                    |                    |                    | the website’s      |
|                    |                    |                    | visitors.          |
|                    |                    |                    |                    |
|                    |                    |                    | <strong>Warning:</strong> You   |
|                    |                    |                    | should never       |
|                    |                    |                    | authenticate this  |
|                    |                    |                    | way from a         |
|                    |                    |                    | client-side app    |
|                    |                    |                    | such as a mobile   |
|                    |                    |                    | app. A hacker      |
|                    |                    |                    | could analyze your |
|                    |                    |                    | app and extract    |
|                    |                    |                    | the credentials    |
|                    |                    |                    | for malicious use  |
|                    |                    |                    | even if those      |
|                    |                    |                    | credentials are    |
|                    |                    |                    | compiled and in    |
|                    |                    |                    | binary format. See |
|                    |                    |                    | <a href="#safe_mobi |
|                    |                    |                    | le">Safe mobile       |
|                    |                    |                    | access</a>                |
|                    |                    |                    | for additional     |
|                    |                    |                    | considerations in  |
|                    |                    |                    | keeping access to  |
|                    |                    |                    | your app and its   |
|                    |                    |                    | data secure.       |
+——————–+——————–+——————–+——————–+
| Admin User         | Allows full access | No                 | This               |
|                    | to perform any     |                    | authentication     |
|                    | operation on all   |                    | level is useful    |
|                    | organization       |                    | from applications  |
|                    | accounts of which  |                    | that provide       |
|                    | the admin user is  |                    | organization-wide  |
|                    | a member. Should   |                    | administration     |
|                    | not be used from a |                    | features. For      |
|                    | mobile client.     |                    | example, the App   |
|                    |                    |                    | Services admin     |
|                    |                    |                    | portal uses this   |
|                    |                    |                    | level of access    |
|                    |                    |                    | because it         |
|                    |                    |                    | requires full      |
|                    |                    |                    | access to the      |
|                    |                    |                    | administration     |
|                    |                    |                    | features.          |
|                    |                    |                    |                    |
|                    |                    |                    | Unless you have a  |
|                    |                    |                    | specific need for  |
|                    |                    |                    | administrative     |
|                    |                    |                    | features, such as  |
|                    |                    |                    | to run test        |
|                    |                    |                    | scripts that       |
|                    |                    |                    | require access to  |
|                    |                    |                    | management         |
|                    |                    |                    | functionality, you |
|                    |                    |                    | should not use the |
|                    |                    |                    | admin user         |
|                    |                    |                    | authentication     |
|                    |                    |                    | level.             |
|                    |                    |                    |                    |
|                    |                    |                    | <strong>Note:</strong>          |
|                    |                    |                    | Currently,         |
|                    |                    |                    | organization and   |
|                    |                    |                    | admin user access  |
|                    |                    |                    | are effectively    |
|                    |                    |                    | the same.          |
|                    |                    |                    | Eventually, the    |
|                    |                    |                    | admin user level   |
|                    |                    |                    | will be a          |
|                    |                    |                    | configurable       |
|                    |                    |                    | subset of the      |
|                    |                    |                    | organization level |
|                    |                    |                    | of access.         |
|                    |                    |                    | <strong>Warning:</strong> You   |
|                    |                    |                    | should never       |
|                    |                    |                    | authenticate this  |
|                    |                    |                    | way from a         |
|                    |                    |                    | client-side app    |
|                    |                    |                    | such as a mobile   |
|                    |                    |                    | app. A hacker      |
|                    |                    |                    | could analyze your |
|                    |                    |                    | app and extract    |
|                    |                    |                    | the credentials    |
|                    |                    |                    | for malicious use  |
|                    |                    |                    | even if those      |
|                    |                    |                    | credentials are    |
|                    |                    |                    | compiled and in    |
|                    |                    |                    | binary format. See |
|                    |                    |                    | <a href="#safe_mobi |
|                    |                    |                    | le">Safe mobile       |
|                    |                    |                    | access</a>                |
|                    |                    |                    | for additional     |
|                    |                    |                    | considerations in  |
|                    |                    |                    | keeping access to  |
|                    |                    |                    | your app and its   |
|                    |                    |                    | data secure.       |
+——————–+——————–+——————–+——————–+
| Organization       | Full access to     | No                 | Providing the      |
|                    | perform any        |                    | greatest amount of |
|                    | operation on an    |                    | access, this       |
|                    | Apache Usergrid       |                    | authentication     |
|                    | organization.      |                    | level lets a       |
|                    | Should not be used |                    | client perform any |
|                    | from a mobile      |                    | operation on an    |
|                    | client.            |                    | Apache Usergrid       |
|                    |                    |                    | organization. This |
|                    |                    |                    | level of access    |
|                    |                    |                    | should be used     |
|                    |                    |                    | sparingly and      |
|                    |                    |                    | carefully.         |
|                    |                    |                    |                    |
|                    |                    |                    | <strong>Note:</strong>          |
|                    |                    |                    | Currently,         |
|                    |                    |                    | organization and   |
|                    |                    |                    | admin user access  |
|                    |                    |                    | are effectively    |
|                    |                    |                    | the same.          |
|                    |                    |                    | Eventually, the    |
|                    |                    |                    | admin user level   |
|                    |                    |                    | will be a          |
|                    |                    |                    | configurable       |
|                    |                    |                    | subset of the      |
|                    |                    |                    | organization level |
|                    |                    |                    | of access.         |
|                    |                    |                    | <strong>Warning:</strong> You   |
|                    |                    |                    | should never       |
|                    |                    |                    | authenticate this  |
|                    |                    |                    | way from a         |
|                    |                    |                    | client-side app    |
|                    |                    |                    | such as a mobile   |
|                    |                    |                    | app. A hacker      |
|                    |                    |                    | could analyze your |
|                    |                    |                    | app and extract    |
|                    |                    |                    | the credentials    |
|                    |                    |                    | for malicious use  |
|                    |                    |                    | even if those      |
|                    |                    |                    | credentials are    |
|                    |                    |                    | compiled and in    |
|                    |                    |                    | binary format. See |
|                    |                    |                    | <a href="#safe_mobi |
|                    |                    |                    | le">Safe mobile       |
|                    |                    |                    | access</a>                |
|                    |                    |                    | for additional     |
|                    |                    |                    | considerations in  |
|                    |                    |                    | keeping access to  |
|                    |                    |                    | your app and its   |
|                    |                    |                    | data secure.       |
+——————–+——————–+——————–+——————–+</p>

<h2 id="adding-code-to-support-authentication">Adding code to support authentication</h2>

<h3 id="using-an-access-token">Using an access token</h3>

<p>When you obtain an access token, you must provide it with every
subsequent API call that you make. There are two ways to provide your
access token.</p>

<ul>
  <li>
    <p>You can add the token to the API query string:\
\</p>

    <pre><code>https://api.usergrid.com/{org-name}/{app-name}/users?access_token={access_token}
</code></pre>
  </li>
  <li>
    <p>You can include the token in an HTTP authorization header:\
\</p>

    <pre><code>Authorization: Bearer {access_token}
</code></pre>
  </li>
</ul>

<p><strong>Note:</strong> The App services documentation assumes you are providing a
valid access token with every API call whether or not it is shown
explicitly in the examples. Unless the documentation specifically says
that you can access an API endpoint without an access token, you should
assume that you must provide it. One application that does not require
an access token is the sandbox application. The Guest role has been
given full permissions (/** for GET, POST, PUT, and DELETE) for this
application. This eliminates the need for a token when making
application level calls to the sandbox app. For further information on
specifying permissions, see <a href="/managing-access-defining-permission-rules">Managing access by defining permission
rules</a>.</p>

<h3 id="authenticating-asapplication-user">Authenticating as Application User</h3>

<p>Using the username and password values specified when the user entity
was created, your app can connect to the Apache Usergrid application
endpoint to request an access token. (Note that it's also possible to
use the user's email address in place of the username.) Here is an
example in cURL format of a request for application user access:</p>

<pre><code>curl -X POST -i -H "Content-Type: application/json" "https://api.usergrid.com/my-org/my-app/token" -d '{"grant_type":"password","username":"john.doe","password":"testpw"}'
</code></pre>

<p>The results include the access token needed to make subsequent API
requests on behalf of the application user:</p>

<pre><code>{
"access_token": "5wuGd-lcEeCUBwBQVsAACA:F8zeMOlcEeCUBwBQVsAACA:YXU6AAABMq0hdy4Lh0ewmmnOWOR-DaepCrpWx9oPmw",
"expires_in": 3600,
"user": {
...
}
}
</code></pre>

<h3 id="authenticating-asapplication">Authenticating as Application</h3>

<p>Using your app’s client id and client secret values, your app can
connect to the Apache Usergrid application endpoint to request an access
token. Here is an example in cURL format of a request for application
access:</p>

<pre><code>curl -X POST -i -H "Content-Type: application/json" "https://api.usergrid.com/my-org/my-app/token" -d '{"grant_type":"client_credentials","client_id":"YXB7NAD7EM0MEeJ989xIxPRxEkQ","client_secret":"YXB7NAUtV9krhhMr8YCw0QbOZH2pxEf"}'
</code></pre>

<p>The results include the access token needed to make subsequent API
requests on behalf of the application:</p>

<pre><code>{
"access_token": "F8zeMOlcEeCUBwBQVsAACA:YXA6AAABMq0d4Mep_UgbZA0-sOJRe5yWlkq7JrDCkA",
"expires_in": 3600,
"application": {
...  
}
}
</code></pre>

<p><strong>Warning:</strong> You should never authenticate this way from a client-side
app such as a mobile app. A hacker could analyze your app and extract
the credentials for malicious use even if those credentials are compiled
and in binary format. See <a href="#safe_mobile">Safe mobile access</a> for
additional considerations in keeping access to your app and its data
secure.</p>

<h3 id="authenticating-asadmin-user">Authenticating as Admin User</h3>

<p>If you do require admin user access, your app can connect to the App
Services management endpoint to request an access token. Your app
supplies the username and password of an admin user in the request. Here
is an example in cURL format of a request for admin user access:</p>

<pre><code>curl -X POST -i -H "Content-Type: application/json" "https://api.usergrid.com/management/token"  -d '{"grant_type":"password","username":"testadmin","password":"testadminpw"}'
</code></pre>

<p>The results include the access token needed to make subsequent API
requests on behalf of the admin user:</p>

<pre><code>{
"access_token": "f_GUbelXEeCfRgBQVsAACA:YWQ6AAABMqz_xUyYeErOkKjnzN7YQXXlpgmL69fvaA",
"expires_in": 3600,
"user": {
...
}
}
</code></pre>

<p><strong>Warning:</strong> You should never authenticate this way from a client-side
app such as a mobile app. A hacker could analyze your app and extract
the credentials for malicious use even if those credentials are compiled
and in binary format. See <a href="#safe_mobile">Safe mobile access</a> for
additional considerations in keeping access to your app and its data
secure.</p>

<h3 id="authenticating-asorganization">Authenticating as Organization</h3>

<p>If you do require organization level access, your app can connect to the
Apache Usergrid management endpoint to request an access token. Access to
an organization requires the client id and client secret credentials.
Here is an example in cURL format of a request for organization access:</p>

<pre><code>curl -X POST -i -H "Content-Type: application/json" "https://api.usergrid.com/management/token" -d '{"grant_type":"client_credentials","client_id":"YXB7NAD7EM0MEeJ989xIxPRxEkQ","client_secret":"YXB7NAUtV9krhhMr8YCw0QbOZH2pxEf"}'
</code></pre>

<p>The results include the access token needed to make subsequent API
requests to the organization:</p>

<pre><code>{
"access_token": "gAuFEOlXEeCfRgBQVsAACA:b3U6AAABMqz-Cn0wtDxxkxmQLgZvTMubcP20FulCZQ",
"expires_in": 3600,
"organization": {
...
}
}
</code></pre>

<p><strong>Warning:</strong> You should never authenticate this way from a client-side
app such as a mobile app. A hacker could analyze your app and extract
the credentials for malicious use even if those credentials are compiled
and in binary format. See <a href="#safe_mobile">Safe mobile access</a> for
additional considerations in keeping access to your app and its data
secure.</p>

<h2 id="authentication-token-time-to-live">Authentication token time to live</h2>

<p>An access token has a “time-to-live”, which is the maximum time that the
access token will be valid for use within the application, specified in
milliseconds. By default, all tokens have a system-defined time-to-live
of 24 hours.</p>

<h3 id="changing-the-default-time-to-live">Changing the default time-to-live</h3>

<p>You can change the default time-to-live for all application tokens by
updating the Application entity’s accesstokenttl property. </p>

<p>For example, the following updates an application entity to have a
default time-to-live value of 1800000 miliseconds (30 minutes) for all
tokens:</p>

<pre><code>curl -X PUT -i -H "Content-Type: application/json" "https://api.usergrid.com/my-org/my-app" -d '{"accesstokenttl":"1800000"}'
</code></pre>

<h3 id="changing-token-time-to-live">Changing token time-to-live</h3>

<p>When you request an access token, you can override its time-to-live by
including a ttl parameter in the request.</p>

<p>The ttl value must be equal to or less than the value of the
accesstokenttl property. If you specify a ttl value greater than the
value of accesstokenttl, an error message is returned that indicates the
maximum time to live value that can be specified.</p>

<p><strong>Note: </strong>If you set ttl=0, the token will never expire. This can pose a
security risk and should be used with caution.</p>

<p>For example, the following sets a time to live value of 1800000
miliseconds (30 minutes) for an admin user:</p>

<pre><code>curl -X POST -i -H "Content-Type: application/json" "https://api.usergrid.com/management/token?ttl=1800000" -d '{"grant_type":"client_credentials","client_id":"YXB7NAD7EM0MEeJ989xIxPRxEkQ","client_secret":"YXB7NAUtV9krhhMr8YCw0QbOZH2pxEf"}'
</code></pre>

<p>The following sets the same time to live value for an application user.</p>

<pre><code>curl -X POST -i -H "Content-Type: application/json" "https://api.usergrid.com/my-org/my-app/token?ttl=1800000" -d '{"grant_type":"password","username":"testadmin","password":"testadminpw"}'
</code></pre>

<h2 id="revoking-authentication-tokens">Revoking authentication tokens</h2>

<p>Under certain circumstances, you may need to explicitly revoke a user's
access token, such as when a user logs out. To revoke a specific
authentication token, send the following <code>PUT</code> request:</p>

<pre><code>curl -X PUT https://api.usergrid.com/&lt;org_name&gt;/&lt;app_name&gt;/users/&lt;user_uuid_or_username&gt;/revoketokens?token="&lt;token&gt;"
</code></pre>

<p>If the token is successfully revoked, you will receive the following
response from the API:</p>

<pre><code>{
  "action" : "revoked user token",
  "timestamp" : 1382050891455,
  "duration" : 24
}
</code></pre>

<h2 id="safe-mobile-access">Safe mobile access</h2>

<p>For mobile access, it is recommended that you connect as an application
user with configured access control policies. Mobile applications are
inherently untrusted because they can be easily examined and even
decompiled.</p>

<p>Any credentials stored in a mobile app should be considered secure only
to the Application User level. This means that if you don’t want the
user to be able to access or delete data in your Apache Usergrid
application, you need to make sure that you don’t enable that capability
through roles or permissions. Because most web applications talk to the
database using some elevated level of permissions, such as root, it’s
generally a good idea for mobile applications to connect with a more
restricted set of permissions. For more information on restricting
access through permission rules, see <a href="/managing-access-defining-permission-rules">Managing access by defining
permission rules</a>.</p>

    </div>
  </div>
</div><footer class="bs-footer" role="contentinfo">
      <div class="container">
        <p class="text-muted">
          环信即时通讯云
        </p>
      </div>
    </footer>
    <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/holder/2.0/holder.min.js"></script>
    <script src="http://cdn.bootcss.com/highlight.js/7.3/highlight.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3e5b3453fdcff1e4dec124ea22f1e189' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script src="/assets/js/application.js"></script>
  </body>
</html>