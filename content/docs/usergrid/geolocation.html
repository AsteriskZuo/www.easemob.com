<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Easemob - 即时通讯云-五分钟为你的APP加入聊天功能。" name="description">
    <meta content="Easemob" name="author">
    <title>Geolocation | Easemob</title>
    <link href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/docs.css" rel="stylesheet">
    <link href="http://cdn.bootcss.com/highlight.js/7.3/styles/github.min.css" rel="stylesheet">
    <style type="text/css">
      body{font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","WenQuanYi Micro Hei",sans-serif;}
      h1, .h1, h2, .h2, h3, .h3, h4, .h4, .lead {font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","Microsoft YaHei UI","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}
      pre code { background: transparent; }
      @media (min-width: 768px) {
          .bs-docs-home .bs-social,
          .bs-docs-home .bs-masthead-links {
            margin-left: 0;
          }
      }
    </style>
    <!--[if lt IE 9]
    script  type='text/javascript' src=("/assets/js/ie8-responsive-file-warning.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js" ) 
    script  type='text/javascript' src=("http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js" ) -->
    <link href="/assets/ico/apple-touch-icon-144-precomposed.png" rel="apple-touch-icon-precomposed" sizes="144x144">
    <link href="/assets/ico/favicon.ico" rel="shortcut icon">
  </head>
  <body><div id="content" class="bs-header">
  <div class="container">
    <h1>
      Geolocation
    </h1>
    <p>
      Easemob
    </p>
  </div>
</div>
<div class="container bs-docs-container">
  <div class="row">
    <div class="col-md-12" role="main">
<h1 id="geolocation">Geolocation</h1>

<p>Many of today's apps are enhanced by the use of <em>geolocation</em>, wireless
detection of the physical location of a remote device. These apps are
said to be <em>geolocation-aware</em> in that they query the device to
determine the user's position and then use this data to further enhance
the user's experience. For example, apps can capture the exact location
where a picture was taken or a message was created.</p>

<p>App services support geolocation on any entity, both built in (e.g.,
users, groups) and user defined.</p>

<h2 id="adding-a-location-to-an-entity">Adding a location to an entity</h2>

<p>To add a location to any entity, include the following member to the
JSON in a POST or PUT call:</p>

<pre><code>"location": {
    "latitude": 37.779632,
    "longitude": -122.395131  
} 
</code></pre>

<p>For example, to store a listing of restaurants and their locations,
start by creating a collection called restaurants:</p>

<pre><code>POST https://api.usergrid.com/org_name/app_name/restaurants
</code></pre>

<p>Next, add a new entity to the collection:</p>

<pre><code>POST https://api.usergrid.com/org_name/app_name/restaurants
{
  "name": "Rockadero",
  "address": "21 Slate Street, Bedrock, CA",
  "location": {
    "latitude": 37.779632,
    "longitude": -122.395131
  }
}
</code></pre>

<p>This creates a new restaurant entity called "Rockadero" with the
longitude and latitude included as part of the object.</p>

<p>You can also use geolocation to keep track of the location of a user. In
this case, the user already exists, so you just need to update that user
entity. Use POST and include the location member:</p>

<pre><code>POST https://api.usergrid.com/org_name/app_name/users/fred
{
  "location": {
    "latitude": 37.779632,
    "longitude": -122.395131
  }
}
</code></pre>

<p>This either adds or updates the location member of the user object for
the user fred.</p>

<h2 id="making-queries-against-an-entitys-location">Making queries against an entity's location</h2>

<p>When a location is added to an entity, it is easy to make queries
against that data. For example, to see all restaurants within a 10 mile
radius of the user's location, make a GET call against that entity, and
include a search query in the following format:</p>

<pre><code>location within &lt;distance in meters&gt; of &lt;latitude&gt;, &lt;longitude&gt;
</code></pre>

<p>If we use the location of our user Fred, we first need to convert miles
to meters. 1 mile is equivalent to 1609.344 meters, so 10 miles is about
16093 meters. Thus, the API call looks like this:</p>

<pre><code>GET https://api.usergrid.com/org_name/app_name/restaurants?ql=location within 16093 of 37.776753, -122.407846
</code></pre>

<p>The url-encoded version looks like this:</p>

<pre><code>https://api.usergrid.com/org_name/app_name/restaurants?ql=location%20within%2016093%20of%2037.776753%2C%20-122.407846&amp;_=1337570474469
</code></pre>

<p>In this case, the API call returns one entry for the Rockadero, which is
exactly where Fred happens to be. Bon Appetit!</p>

    </div>
  </div>
</div><footer class="bs-footer" role="contentinfo">
      <div class="container">
        <p class="text-muted">
          环信即时通讯云
        </p>
      </div>
    </footer>
    <script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script src="http://cdn.bootcss.com/holder/2.0/holder.min.js"></script>
    <script src="http://cdn.bootcss.com/highlight.js/7.3/highlight.min.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3e5b3453fdcff1e4dec124ea22f1e189' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script src="/assets/js/application.js"></script>
  </body>
</html>